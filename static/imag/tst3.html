<script>
function crop(img) {

    url = "/crop";
    const xhr = new XMLHttpRequest()
    xhr.onload = () => {
      	if (xhr.status >= 200 && xhr.status < 300) {
            const response = JSON.parse(xhr.responseText);
	          console.log(response);
         }
    } 
    xhr.open('POST', url)
    xhr.setRequestHeader('Content-Type', 'application/json')
    xhr.send(JSON.stringify({"img": img}))
}

  
var reader1 = new FileReader();

reader1.addEventListener('load', e => {
  document.querySelector('#img').src = e.target.result;
  document.getElementById("dload").href = e.target.result;
  crop(e.target.result);
});

document.addEventListener('DOMContentLoaded', e => {
  document.forms.pickfile.file.addEventListener('change', e => {
    reader1.readAsDataURL(e.target.files[0]);
  });
});

</script>

<img id="img" />

<form name="pickfile">
  <input name="file" type="file" />
</form>

<a download="out.jpg" id="dload" href="">Download</a>

